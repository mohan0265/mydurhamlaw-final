const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = require('docx');
const fs = require('fs');

// Mimics exactly what AssignmentDetail.tsx does
const finalDraft = `INTRODUCTION TO ARTICLE 10 ECHR

Freedom of expression is a foundational pillar of democratic societies, protected under Article 10 of the European Convention on Human Rights (ECHR). This fundamental right enables individuals to hold and express opinions without unwarranted state interference.

TEST PARAGRAPH 2

This is another paragraph to test multi-paragraph handling.`;

const paragraphs = finalDraft
  .split(/\n+/)
  .map(p => p.trim())
  .filter(p => p.length > 0);

console.log('Paragraphs found:', paragraphs.length);

const doc = new Document({
  creator: "MyDurhamLaw",
  title: "Test Assignment",
  description: "Generated by MyDurhamLaw Assignment Assistant",
  sections: [{
    properties: {},
    children: [
      new Paragraph({
        text: "LAW 1081",
        heading: HeadingLevel.HEADING_1,
        alignment: AlignmentType.CENTER,
        spacing: { before: 400, after: 200 },
      }),
      new Paragraph({
        text: "Contract Law",
        alignment: AlignmentType.CENTER,
        spacing: { after: 400 },
      }),
      new Paragraph({ text: "", pageBreakBefore: true }),
      
      ...paragraphs.map(para => 
        new Paragraph({
          children: [new TextRun({ text: para, font: "Times New Roman", size: 24 })],
          spacing: { before: 120, after: 120 },
          alignment: AlignmentType.JUSTIFIED,
        })
      ),
    ],
  }],
});

Packer.toBuffer(doc).then(buffer => {
  fs.writeFileSync('test-output.docx', buffer);
  console.log('âœ… Document created: test-output.docx');
  console.log('File size:', buffer.length, 'bytes');
});
